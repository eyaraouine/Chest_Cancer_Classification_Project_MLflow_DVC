import React, { useState } from 'react';
import './App.css'; // Import your CSS file here

function App() {
  const [imageFile, setImageFile] = useState(null);
  const [imageUrl, setImageUrl] = useState(null);
  const [prediction, setPrediction] = useState(null);
  const [showPopup, setShowPopup] = useState(false);

  const handleImageUpload = (event) => {
    const file = event.target.files[0];
    setImageFile(file);
    const reader = new FileReader();
    reader.onload   
 = (e) => setImageUrl(e.target.result);
    reader.readAsDataURL(file);
  };

  const handlePredict = async () => {
    if (!imageFile) return;

    const formData = new FormData();
    formData.append('image', imageFile);

    try {
      const response = await fetch('/predict', {
        method: 'POST',
        body: formData,   

      });
      const data = await response.json();
      setPrediction(data[0]);
      setShowPopup(true);
    } catch (error) {
      console.error('Error fetching prediction:', error);
      // Handle errors appropriately, maybe show an error message
    } finally {
      // Hide loading indicator (if implemented)
    }
  };

  const handleClosePopup = () => setShowPopup(false);

  return (
    <div className="main container">
      <section className="iupload">
        <h3 className="text-center py-4">Chest Cancer Classification</h3>
        <div className="row">
          <div className="img-part col-md-6">
            <div className="image-part">
              {imageUrl ? (
                <img src={imageUrl} alt="Uploaded Image" />
              ) : (
                <video id="video" autoplay muted loop>
                  {/* Add a placeholder or poster image for the video */}
                </video>
              )}
            </div>
            <div className="btn-part">
              <form id="upload-data pt-3" className="">
                <div className="input-group mt-3 row">
                  <button
                    type="button"
                    className="btn btn-primary col-md-5 col-xs-5 ml-3 mr-4"
                    onClick={() => document.getElementById('fileinput').click()}
                  >
                    Upload
                  </button>
                  <button
                    type="button"
                    className="btn btn-success col-md-5 col-xs-5"
                    onClick={handlePredict}
                    disabled={!imageFile}
                  >
                    Predict
                  </button>
                </div>
                <input
                  type="hidden"
                  className="form-control mr-2"
                  id="url"
                  placeholder="Enter REST Api url..."
                  value="/predict" // Replace with your actual prediction endpoint
                />
                <input type="file" id="fileinput" style={{ display: 'none' }} onChange={handleImageUpload} />
              </form>
            </div>
          </div>
          <div className="col-md-6 col-xs-12 right-part">
            <h5 className="mb-2">
              <center>Prediction Results</center>
            </h5>
            {prediction && (
              <Popup prediction={prediction} onClose={handleClosePopup} />
            )}
          </div>
        </div>
      </section>
    </div>
  );
}

function Popup({ prediction, onClose }) {
  return (
    <div className="popup">
      <div className="popup-content">
        <h2>Prediction</h2>
        <pre>{JSON.stringify(prediction, null, 2)}</pre>
        <button onClick={onClose}>Close</button>
      </div>
    </div>
  );
}

export default App;